<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000">
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top">
  
  
  <title>[Tomcat][2][Tomcat总体架构] | T0UGU BLOG</title>
  <meta name="description" content="第2章 Tomcat总体架构 作为一款知名的轻量级应用服务器， Tomcat的架构设计（如生命周期管理、可扩展的容器组件设计、类加载方式）可以为我们的服务器中间件设计，甚至是应用系统组件设计提供非常好的借鉴意义。 本章主要包含如下几个部分  Tomcat总体架构设计及 Tomcat各组件的概念。 Tomcat启动及请求处理过程。 Tomcat的类加载器。   2.1 总体设计 为了使读者能更深刻">
<meta name="keywords" content="Tomcat">
<meta property="og:type" content="article">
<meta property="og:title" content="[Tomcat][2][Tomcat总体架构]">
<meta property="og:url" content="https://t0ugh.biz/2020/11/11/Tomcat-2-Tomcat总体架构/index.html">
<meta property="og:site_name" content="打怪升级日常">
<meta property="og:description" content="第2章 Tomcat总体架构 作为一款知名的轻量级应用服务器， Tomcat的架构设计（如生命周期管理、可扩展的容器组件设计、类加载方式）可以为我们的服务器中间件设计，甚至是应用系统组件设计提供非常好的借鉴意义。 本章主要包含如下几个部分  Tomcat总体架构设计及 Tomcat各组件的概念。 Tomcat启动及请求处理过程。 Tomcat的类加载器。   2.1 总体设计 为了使读者能更深刻">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://i.loli.net/2020/09/27/9nMmRBO3cbDEWzi.png">
<meta property="og:image" content="https://i.loli.net/2020/09/27/6pjmQqsnOVM7zC2.png">
<meta property="og:image" content="https://i.loli.net/2020/09/27/PKVJ4Hgsz1yvGld.png">
<meta property="og:image" content="https://i.loli.net/2020/09/27/B1KqUvlyL86xniS.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927142652.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927142920.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927143525.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927144159.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927144653.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927145113.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927145520.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927151529.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927151918.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927152234.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927152815.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927154104.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/21312.jpg">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927155015.png">
<meta property="og:image" content="https://healthlung.oss-cn-beijing.aliyuncs.com/20200928122827.png">
<meta property="og:updated_time" content="2020-11-11T09:12:21.764Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[Tomcat][2][Tomcat总体架构]">
<meta name="twitter:description" content="第2章 Tomcat总体架构 作为一款知名的轻量级应用服务器， Tomcat的架构设计（如生命周期管理、可扩展的容器组件设计、类加载方式）可以为我们的服务器中间件设计，甚至是应用系统组件设计提供非常好的借鉴意义。 本章主要包含如下几个部分  Tomcat总体架构设计及 Tomcat各组件的概念。 Tomcat启动及请求处理过程。 Tomcat的类加载器。   2.1 总体设计 为了使读者能更深刻">
<meta name="twitter:image" content="https://i.loli.net/2020/09/27/9nMmRBO3cbDEWzi.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://t0ugh.biz/2020/11/11/Tomcat-2-Tomcat总体架构/index.html">
  
    <link rel="alternate" href="/atom.xml" title="打怪升级日常" type="application/atom+xml">
  
  
    <link rel="icon" href="https://i.loli.net/2020/03/21/WAKimNUecFR64uo.jpg" type="image/x-icon">
  
  <link rel="stylesheet" href="/css/style.css">
  
  
  
  
</head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/t0ugh" target="_blank">
          <img class="img-circle img-rotate" src="https://i.loli.net/2020/03/21/WAKimNUecFR64uo.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">T0UGH</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">学生&amp;编程爱好者</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> ShenYang, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search">
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech="">
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope="" itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/t0ugh" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope="" itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>东北大学软件工程本科在读</p><p>我的邮箱:wang.g.p@foxmail.com</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flink/">Flink</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GitHub/">GitHub</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java并发/">Java并发</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Junit/">Junit</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyBatis/">MyBatis</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SSM/">SSM</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringBoot/">SpringBoot</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tensorflow/">Tensorflow</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat/">Tomcat</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jvm/">jvm</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/vim/">vim</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/nlp/">nlp</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务设计/">微服务设计</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/敏捷开发/">敏捷开发</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/流畅的Python/">流畅的Python</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/深度学习/">深度学习</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法导论/">算法导论</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/蓝桥杯/">蓝桥杯</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/">AOP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C++</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CNN/">CNN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flink/">Flink</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/">GitHub</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GithubFlow/">GithubFlow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA/">JAVA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Junit/">Junit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LSTM/">LSTM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MNIST/">MNIST</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/">MyBatis</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NLP/">NLP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REST/">REST</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RNN/">RNN</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrum/">Scrum</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/">SpringBoot</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/">SpringCloud</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringMVC/">SpringMVC</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tensorflow/">Tensorflow</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/">Tomcat</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YAML/">YAML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aof/">aof</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/">jvm</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nlp/">nlp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rdb/">rdb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中文分词/">中文分词</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/关键词提取/">关键词提取</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分治算法/">分治算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/动态规划/">动态规划</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大数据/">大数据</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发/">并发</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微服务/">微服务</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微服务设计/">微服务设计</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/排序/">排序</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/敏捷原则/">敏捷原则</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/敏捷宣言/">敏捷宣言</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/敏捷开发/">敏捷开发</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库事务/">数据库事务</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/流处理/">流处理</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深度学习/">深度学习</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/神经网络/">神经网络</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法导论/">算法导论</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/蓝桥杯/">蓝桥杯</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/词性标注/">词性标注</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/贪心算法/">贪心算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件测试/">软件测试</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/AOP/" style="font-size: 13px;">AOP</a> <a href="/tags/C/" style="font-size: 13.17px;">C++</a> <a href="/tags/CNN/" style="font-size: 13px;">CNN</a> <a href="/tags/Docker/" style="font-size: 13.17px;">Docker</a> <a href="/tags/ES6/" style="font-size: 13px;">ES6</a> <a href="/tags/Flink/" style="font-size: 13.42px;">Flink</a> <a href="/tags/Git/" style="font-size: 13px;">Git</a> <a href="/tags/GitHub/" style="font-size: 13.17px;">GitHub</a> <a href="/tags/GithubFlow/" style="font-size: 13px;">GithubFlow</a> <a href="/tags/JAVA/" style="font-size: 13px;">JAVA</a> <a href="/tags/Java/" style="font-size: 13.33px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 13.17px;">JavaScript</a> <a href="/tags/Junit/" style="font-size: 13px;">Junit</a> <a href="/tags/LSTM/" style="font-size: 13px;">LSTM</a> <a href="/tags/MNIST/" style="font-size: 13px;">MNIST</a> <a href="/tags/MongoDB/" style="font-size: 13px;">MongoDB</a> <a href="/tags/MyBatis/" style="font-size: 14px;">MyBatis</a> <a href="/tags/MySQL/" style="font-size: 13.25px;">MySQL</a> <a href="/tags/NLP/" style="font-size: 13px;">NLP</a> <a href="/tags/Python/" style="font-size: 13.83px;">Python</a> <a href="/tags/REST/" style="font-size: 13px;">REST</a> <a href="/tags/RNN/" style="font-size: 13.08px;">RNN</a> <a href="/tags/Redis/" style="font-size: 13.17px;">Redis</a> <a href="/tags/Scrum/" style="font-size: 13.08px;">Scrum</a> <a href="/tags/Spring/" style="font-size: 13.25px;">Spring</a> <a href="/tags/SpringBoot/" style="font-size: 13.58px;">SpringBoot</a> <a href="/tags/SpringCloud/" style="font-size: 13.08px;">SpringCloud</a> <a href="/tags/SpringMVC/" style="font-size: 13.17px;">SpringMVC</a> <a href="/tags/Tensorflow/" style="font-size: 13.58px;">Tensorflow</a> <a href="/tags/Tomcat/" style="font-size: 13.08px;">Tomcat</a> <a href="/tags/YAML/" style="font-size: 13px;">YAML</a> <a href="/tags/aof/" style="font-size: 13px;">aof</a> <a href="/tags/c/" style="font-size: 13px;">c</a> <a href="/tags/java/" style="font-size: 13.67px;">java</a> <a href="/tags/jvm/" style="font-size: 13.42px;">jvm</a> <a href="/tags/linux/" style="font-size: 13px;">linux</a> <a href="/tags/nlp/" style="font-size: 13.17px;">nlp</a> <a href="/tags/rdb/" style="font-size: 13px;">rdb</a> <a href="/tags/redis/" style="font-size: 13.92px;">redis</a> <a href="/tags/vue/" style="font-size: 13.08px;">vue</a> <a href="/tags/中文分词/" style="font-size: 13px;">中文分词</a> <a href="/tags/关键词提取/" style="font-size: 13px;">关键词提取</a> <a href="/tags/分治算法/" style="font-size: 13px;">分治算法</a> <a href="/tags/动态规划/" style="font-size: 13.17px;">动态规划</a> <a href="/tags/大数据/" style="font-size: 13.42px;">大数据</a> <a href="/tags/并发/" style="font-size: 13.33px;">并发</a> <a href="/tags/微服务/" style="font-size: 13.33px;">微服务</a> <a href="/tags/微服务设计/" style="font-size: 13.33px;">微服务设计</a> <a href="/tags/排序/" style="font-size: 13.17px;">排序</a> <a href="/tags/敏捷原则/" style="font-size: 13px;">敏捷原则</a> <a href="/tags/敏捷宣言/" style="font-size: 13px;">敏捷宣言</a> <a href="/tags/敏捷开发/" style="font-size: 13.25px;">敏捷开发</a> <a href="/tags/数据库事务/" style="font-size: 13.08px;">数据库事务</a> <a href="/tags/数据结构/" style="font-size: 13.33px;">数据结构</a> <a href="/tags/机器学习/" style="font-size: 13.5px;">机器学习</a> <a href="/tags/流处理/" style="font-size: 13.42px;">流处理</a> <a href="/tags/深度学习/" style="font-size: 13.75px;">深度学习</a> <a href="/tags/神经网络/" style="font-size: 13px;">神经网络</a> <a href="/tags/算法/" style="font-size: 13.08px;">算法</a> <a href="/tags/算法导论/" style="font-size: 13.67px;">算法导论</a> <a href="/tags/蓝桥杯/" style="font-size: 13.08px;">蓝桥杯</a> <a href="/tags/词性标注/" style="font-size: 13px;">词性标注</a> <a href="/tags/贪心算法/" style="font-size: 13px;">贪心算法</a> <a href="/tags/软件测试/" style="font-size: 13px;">软件测试</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">40</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Java并发/">Java并发</a>
              </p>
              <p class="item-title">
                <a href="/2020/11/11/Java并发-5-Java中的锁/" class="title">[Java并发][5][Java中的锁]</a>
              </p>
              <p class="item-date">
                <time datetime="2020-11-11T09:21:10.000Z" itemprop="datePublished">2020-11-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Java并发/">Java并发</a>
              </p>
              <p class="item-title">
                <a href="/2020/11/11/Java并发-4-Java并发编程基础/" class="title">[Java并发][4][Java并发编程基础]</a>
              </p>
              <p class="item-date">
                <time datetime="2020-11-11T09:20:40.000Z" itemprop="datePublished">2020-11-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Java并发/">Java并发</a>
              </p>
              <p class="item-title">
                <a href="/2020/11/11/Java并发-3-Java内存模型/" class="title">[Java并发][3][Java内存模型]</a>
              </p>
              <p class="item-date">
                <time datetime="2020-11-11T09:20:05.000Z" itemprop="datePublished">2020-11-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Java并发/">Java并发</a>
              </p>
              <p class="item-title">
                <a href="/2020/11/11/Java并发-2-Java并发机制的底层实现原理/" class="title">[Java并发][2][Java并发机制的底层实现原理]</a>
              </p>
              <p class="item-date">
                <time datetime="2020-11-11T09:19:20.000Z" itemprop="datePublished">2020-11-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Java并发/">Java并发</a>
              </p>
              <p class="item-title">
                <a href="/2020/11/11/Java并发-1-并发编程的挑战/" class="title">[Java并发][1][并发编程的挑战]</a>
              </p>
              <p class="item-date">
                <time datetime="2020-11-11T09:18:26.000Z" itemprop="datePublished">2020-11-11</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
    <article id="post-Tomcat-2-Tomcat总体架构" class="article article-type-post" itemscope="" itemtype="http://schema.org/BlogPosting">
        
            <div class="article-header">
                
                    
  
    <h1 class="article-title" itemprop="name">
      [Tomcat][2][Tomcat总体架构]
    </h1>
  

                        
                            <div class="article-meta">
                                <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2020/11/11/Tomcat-2-Tomcat总体架构/" class="article-date">
	  <time datetime="2020-11-11T09:12:00.000Z" itemprop="datePublished">2020-11-11</time>
	</a>
</span>
                                    
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Tomcat/">Tomcat</a>
  </span>

                                        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link" href="/tags/Tomcat/">Tomcat</a>
  </span>


                                            

                                                <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/11/11/Tomcat-2-Tomcat总体架构/#comments" class="article-comment-link">Comments</a></span>
                                                
                            </div>
            </div>
            <div class="article-entry marked-body" itemprop="articleBody">
                
                                    
                                        <div id="toc">
                                            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#第2章-tomcat总体架构"><span class="toc-text"> 第2章 Tomcat总体架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-总体设计"><span class="toc-text"> 2.1 总体设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#211-server"><span class="toc-text"> 2.1.1 Server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#212-connector和container"><span class="toc-text"> 2.1.2 Connector和Container</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#213-container设计"><span class="toc-text"> 2.1.3 Container设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#214-lifecycle"><span class="toc-text"> 2.1.4 Lifecycle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#215-pipeline和value"><span class="toc-text"> 2.1.5 Pipeline和Value</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#216-connector设计"><span class="toc-text"> 2.1.6 Connector设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#217-executor"><span class="toc-text"> 2.1.7 Executor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#218-bootstrap和catalina"><span class="toc-text"> 2.1.8 Bootstrap和Catalina</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-tomcat启动"><span class="toc-text"> 2.2 Tomcat启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-请求处理"><span class="toc-text"> 2.3 请求处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-类加载器"><span class="toc-text"> 2.4 类加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#241-j2se标准类加载器"><span class="toc-text"> 2.4.1 J2SE标准类加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#242-tomcat加载器"><span class="toc-text"> 2.4.2 Tomcat加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#243-web应用类加载器"><span class="toc-text"> 2.4.3 Web应用类加载器</span></a></li></ol></li></ol></li></ol>
                                        </div>
                                        
                                            <h2 id="第2章-tomcat总体架构"><a class="markdownIt-Anchor" href="#第2章-tomcat总体架构"></a> 第2章 Tomcat总体架构</h2>
<p>作为一款知名的轻量级应用服务器， Tomcat的<strong>架构设计</strong>（如<strong>生命周期管理</strong>、<strong>可扩展的容器组件设计</strong>、<strong>类加载方式</strong>）可以为我们的服务器中间件设计，甚至是应用系统组件设计提供<strong>非常好的借鉴意义</strong>。</p>
<p>本章主要包含如下几个部分</p>
<ul>
<li>Tomcat<strong>总体架构设计</strong>及 Tomcat<strong>各组件的概念</strong>。</li>
<li>Tomcat<strong>启动及请求处理过程</strong>。</li>
<li>Tomcat的<strong>类加载器</strong>。</li>
</ul>
<h3 id="21-总体设计"><a class="markdownIt-Anchor" href="#21-总体设计"></a> 2.1 总体设计</h3>
<p>为了使读者能更深刻地理解 Tomcat的相关组件概念，我们将采用一种启发式的讲解方式来介绍 Tomcat的总体设计。从如何设计一个应用服务器开始，逐步完善，直至最终推导出 Tomcat的整体架构。</p>
<h4 id="211-server"><a class="markdownIt-Anchor" href="#211-server"></a> 2.1.1 Server</h4>
<p>从最基本的功能来讲，我们可以将服务器描述为这样一个应用</p>
<blockquote>
<p>它<strong>接收</strong>其他计算机（客户端）发来的<strong>请求数据</strong>并进行<strong>解析</strong>，<strong>完成相关业务处理</strong>，然后把处理<strong>结果</strong>作为响应<strong>返回</strong>给请求计算机（客户端）。</p>
</blockquote>
<p><img src="https://i.loli.net/2020/09/27/9nMmRBO3cbDEWzi.png" alt=""></p>
<ul>
<li>
<p>我们通过<code>start()</code>方法启动服务器，<strong>打开 Socket链接，监听服务器端口</strong>，并负责在接收到客户端请求时进行处理并返回响应。</p>
</li>
<li>
<p>通过<code>stop()</code>方法来<strong>停止服务器</strong>并<strong>释放网络资源</strong>。</p>
</li>
</ul>
<h4 id="212-connector和container"><a class="markdownIt-Anchor" href="#212-connector和container"></a> 2.1.2 Connector和Container</h4>
<p>很快我们就会发现，将<strong>请求监听</strong>与<strong>请求处理</strong>放到 <strong>一起</strong> <strong>扩展性很差</strong>，比如当我们想适配多种网络协议，但是请求处理却相同的时候。</p>
<p><img src="https://i.loli.net/2020/09/27/6pjmQqsnOVM7zC2.png" alt=""></p>
<ul>
<li>一个Server可以<strong>包含多个</strong> Connector和 Container。</li>
<li>其中<strong>Connector</strong>负责开启 Socket并<strong>监听客户端请求</strong>，返回响应数据；</li>
<li><strong>Container</strong>负责<strong>具体的请求处理</strong>。</li>
<li><strong>Connector</strong>和 <strong>Container</strong>分别<strong>拥有自己的<code>start()</code>和<code>stop()</code>方法</strong>来<strong>加载和释放</strong>自己维护的资源。</li>
</ul>
<p>但是，这个设计有个明显的<strong>缺陷</strong>。既然 Server可以包含多个 Connector和 Container，那么<strong>如何知晓</strong>来自<strong>某个 Connector的请求</strong>由<strong>哪个 Container处理</strong>呢？</p>
<p><img src="https://i.loli.net/2020/09/27/PKVJ4Hgsz1yvGld.png" alt=""></p>
<ul>
<li>一个Server包含多个 Service（它们互相独立，只是共享一个JVM以及系统类库）</li>
<li>一个<strong>Service负责维护</strong> <strong>多个 Connector</strong>和 <strong>一个Container</strong>，这样<strong>来自 Connector的请求</strong>只能由<strong>它所属 Service维护的Container处理</strong>。</li>
</ul>
<h4 id="213-container设计"><a class="markdownIt-Anchor" href="#213-container设计"></a> 2.1.3 Container设计</h4>
<p><strong>应用服务器</strong>是用来部署并运行Web应用的，是一个<strong>运行环境</strong>，而不是一个独立的业务处理系统。因此，我们需要在 Engine容器中支持<strong>管理多个Web应用</strong>，当接收到 Connector的处理请求时， Engine容器能够找到一个合适的Web应用来处理。</p>
<p><img src="https://i.loli.net/2020/09/27/B1KqUvlyL86xniS.png" alt=""></p>
<p>我们使用<strong>Context</strong>来表示一个<strong>Web应用</strong>，并且<strong>一个 Engine</strong>可以<strong>包含多个 Context</strong></p>
<p>但是，设想我们有<strong>一台主机</strong>，它承担了<strong>多个域名的服务</strong>，<code>news.mycompany. com</code>、<code>article.mycompany.com</code>均由该主机处理，我们应如何实现呢？</p>
<p>既然我们要提供多个域名的服务，那么就可以将<strong>每个域名</strong>视为一个<strong>虚拟主机</strong>，在<strong>每个虚拟主机下包含多个web应用</strong>。因为对于客户端用户来说，他们并不了解服务端使用几台主机来为他们提供服务，只知道每个域名提供了哪些服务，因此，应用服务器将每个域名抽象为一个虚拟主机从概念上是合理的。</p>
<ul>
<li>我们用<strong>Host</strong>表示<strong>虚拟主机</strong>的概念</li>
<li><strong>一个Host</strong>可以包含<strong>多个Context</strong></li>
</ul>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927142652.png" alt=""></p>
<blockquote>
<p>在 Tomcat的设计中， <strong>Engine</strong>既可以<strong>包含Host</strong>，又可以<strong>包含 Context</strong>，这是由具体的 Engine实现确定的，而且 Tomcat采用一种通用的概念解决此问题，我们在后续部分会详细讲解。Tomcat提供的<strong>默认实现 Standard Engine只能包含 Host</strong></p>
</blockquote>
<p>在一个<strong>Web应用</strong>中，可<strong>包含多个Servlet实例</strong>以<strong>处理来自不同链接的请求</strong>。因此，我们还需要一个组件概念来表示Servlet定义。在 Tomcat中， <strong>Servlet</strong>定义被称为<strong>Wrapper</strong>，</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927142920.png" alt=""></p>
<p><strong>容器</strong>是指一类<strong>处理接收自客户端的请求并且返回响应数据</strong>的<strong>组件</strong>，前文提到的Engine、Host、Context、Wrapper均可属于<strong>容器</strong>。</p>
<p>我们使用 <strong>Container</strong>来表示容器</p>
<ul>
<li>Container可以添加并维护子容器，因此 Engine、Host、 Context、Wrapper均<strong>继承</strong>自 Container。</li>
<li>我们将它们之间的组合关系改为虚线，以表示它们之间是<strong>弱依赖</strong>的关系，即它们之间的关系是通过 Container的父子容器的概念体现的。</li>
<li>不过 <strong>Service持有</strong>的是 <strong>Engine接口</strong>（8.56版本之前为 Container接口，更加通用）。</li>
</ul>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927143525.png" alt=""></p>
<blockquote>
<p>既然 Tomcat的 <strong>Container</strong>可以表示<strong>不同的概念级别</strong>：Servlet引擎、虚拟主机、Web应用和Servlet，那么我们就<strong>可以将不同级别的容器作为处理客户端请求的组件</strong>，这<strong>具体由</strong>我们提供的<strong>服务器的复杂度决定</strong>。假使我们以嵌入式的方式启动 Tomcat，且运行极其简单的请求处理，不必支持多Web应用的场景，那么我们完全可以只在 Service中维护一个简化版的Engine。</p>
</blockquote>
<p>此外， Tomcat的Container还有一个很重要的功能，就是<strong>后台处理</strong>。</p>
<ul>
<li>在很多情况下，我们的Container需要执行一些<strong>异步处理</strong>，而且是<strong>定期执行</strong>，如每隔30秒执行一次， Tomcat对于Web应用文件变更的扫描就是通过该机制实现的。</li>
<li>Tomcat针对后台处理，在Container上<strong>定义了<code>backgroundProcess()</code>方法</strong>来<strong>抽象后台处理</strong>。</li>
</ul>
<h4 id="214-lifecycle"><a class="markdownIt-Anchor" href="#214-lifecycle"></a> 2.1.4 Lifecycle</h4>
<p>不难发现，所有<strong>组件</strong>均存在启动、停止等生命周期方法，<strong>拥有生命周期管理的特性</strong>。因此，我们<strong>基于生命周期管理</strong>进行一次<strong>接口抽象</strong>。</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927144159.png" alt=""></p>
<p>我们针对<strong>所有拥有生命周期管理特性</strong>的组件<strong>抽象了一个 Lifecycle通用接口</strong>，该接口定义了生命周期管理的核心方法。</p>
<ul>
<li><code>init()</code>：初始化组件。</li>
<li><code>start()</code>：启动组件</li>
<li><code>stop()</code>：停止组件。</li>
<li><code>destroy()</code>：销毁组件。</li>
</ul>
<p>同时，该接口<strong>支持组件状态</strong>以及<strong>状态之间的转换</strong>，支持<strong>添加事件监听器</strong>用于<strong>监听组件的状态变化</strong>。如此，我们可以采用一致的机制来初始化、启动、停止以及销毁各个组件。如<strong>Tomcat核心组件</strong>的默认实现均<strong>继承自LifecycleMBeanBase抽象类</strong>，该类不但<strong>负责组件各个状态的转换</strong>和<strong>事件处理</strong>。</p>
<p>Tomcat的Lifecycle接口状态图如下所示</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927144653.png" alt=""></p>
<h4 id="215-pipeline和value"><a class="markdownIt-Anchor" href="#215-pipeline和value"></a> 2.1.5 Pipeline和Value</h4>
<p>在Tomcat中<strong>每个Container组件</strong>通过执行一个<strong>职责链</strong>来<strong>完成具体的请求处理</strong>。Tomcat<strong>定义</strong>了<strong>Pipeline（管道）<strong>和 <strong>Valve（阀）<strong>两个接口。前者用于</strong>构造职责链</strong>，后者代表</strong>职责链上的每个处理器</strong>。</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927145113.png" alt=""></p>
<ul>
<li>
<p>Pipeline中维护了一个<strong>基础的Valve</strong>，它始终<strong>位于Pipeline的末端</strong>（即最后执行），封装了具体的请求处理和输出响应的过程。</p>
</li>
<li>
<p>然后，通过**<code>addvalue()</code>方法**，我们可以<strong>为Pipeline添加其他的Valve</strong>。后添加的 Valve位于基础 Valve之前，并按照添加顺序执行。</p>
</li>
<li>
<p>Pipeline通过获得首个 Valve来启动整个链条的执行。</p>
</li>
</ul>
<p>Tomcat容器组件的灵活之处在于，每个层级的容器（ Engine、Host、 Context、 Wrapper）均有对应的基础 Valve实现，同时维护了一个 Pipeline实例。也就是说，<strong>我们可以在任何层级的容器上针对请求处理进行扩展</strong>。</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927145520.png" alt=""></p>
<h4 id="216-connector设计"><a class="markdownIt-Anchor" href="#216-connector设计"></a> 2.1.6 Connector设计</h4>
<p>接下来，我们再细化一下服务器设计中的另一个重要组件—<strong>Connector</strong></p>
<p>要想与 Container配合实现一个完整的服务器功能， <strong>Connector至少要完成如下几项功能。</strong></p>
<ul>
<li><strong>监听</strong>服务器<strong>端口</strong>，<strong>读取</strong>来自客户端的<strong>请求</strong>。</li>
<li>将<strong>请求数据</strong>按照指定<strong>协议</strong>进行<strong>解析</strong>。</li>
<li>根据<strong>请求地址</strong> <strong>匹配</strong>正确的<strong>容器</strong>进行处理。</li>
<li>将<strong>响应返回客户端</strong>。</li>
</ul>
<p>我们知道，Tomcat<strong>支持多协议</strong>，默认支持HTTP和AJP。同时，Tomcat还<strong>支持多种I/O方式</strong>，包括BIO（8.5版本之后移除）、NIO、APR。而且在Tomcat8之后新增了对NIO2和HTTP2协议的支持。因此，<strong>对协议和I/O进行抽象和建模</strong>是需要重点关注的。</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927151529.png" alt=""></p>
<ul>
<li>在Tomcat中，<strong>ProtocalHandler</strong>表示一个<strong>协议处理器</strong>，针对<strong>不同的协议和I/O方式</strong>来提供<strong>不同的实现</strong>，如Http11NioProtocol表示NIO的HTTP协议处理器</li>
<li>ProtocolHandler包含一个<strong>Endpoint</strong>用于<strong>启动 Socket监听</strong>，该接口<strong>按照I/O方式</strong>进行<strong>分类实现</strong>，如NIO2Endpoint表示非阻塞式Socket l/O。<br>
还包含一个<strong>Processor</strong>用于<strong>按照指定协议读取数据</strong>，并<strong>将请求交由容器处理</strong>，如Http11NIOProcessor表示在NIO的方式下HTTP请求的处理类。</li>
</ul>
<p>在Connector启动时， Endpoint会启动线程来监听服务器端口，并在接收到请求后调用Processor进行数据读取。</p>
<p>当 Processor读取客户端请求后，需要<strong>按照请求地址映射到具体的容器进行处理</strong>，这个过程即为<strong>请求映射</strong>。</p>
<ul>
<li>Tomcat通过<code>Mapper</code>和 <code>MapperListener</code>两个类实现上述功能。</li>
<li>前者用于<strong>维护容器映射信息</strong>，同时按照映射规则（ Servlet规范定义）<strong>查找容器</strong>。</li>
<li>后者实现了 <code>Containerlistener</code>和 <code>LifecycleListener</code>，用于在容器组件状态发生变更时，<strong>注册或者取消对应的容器映射信息</strong>。</li>
<li>Tomcat通过<strong>适配器模式</strong>（ Adapter）实现了 Connector与 Mapper、 Container的<strong>解耦</strong>。 Tomcat默认的 Connector实现（ Coyote）对应的适配器为<code>CoyoteAdapter</code>。</li>
</ul>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927151918.png" alt=""></p>
<h4 id="217-executor"><a class="markdownIt-Anchor" href="#217-executor"></a> 2.1.7 Executor</h4>
<p>Tomcat提供了 <strong>Executor接口</strong>来表示一个可以<strong>在组件间共享的线程池</strong>（默认使用了JDK5提供的线程池技术），该接口<strong>同样继承自Lifecycle</strong>，可按照通用的组件进行管理。</p>
<p>线程池的共享范围如何确定？在 Tomcat中Executor由 Service维护，因此<strong>同一个 Service中的组件可以共享一个线程池</strong>。</p>
<p>在 Tomcat中， Endpoint会<strong>启动一组线程</strong>来<strong>监听Socket端口</strong>，当<strong>接收到客户端请求</strong>后，会<strong>创建请求处理对象，并交由线程池处理</strong>，由此支持并发处理客户端请求。</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927152234.png" alt=""></p>
<h4 id="218-bootstrap和catalina"><a class="markdownIt-Anchor" href="#218-bootstrap和catalina"></a> 2.1.8 Bootstrap和Catalina</h4>
<p>Tomcat通过类<strong>Catalina</strong>提供了一个Shell程序，用于<strong>解析</strong><code>server. xml</code>，并<strong>创建各个组件</strong>，同时，负责<strong>启动、停止Tomcat应用服务器</strong>。</p>
<p>Tomcat使用<strong>Digester</strong> <strong>解析XML文件</strong>，包括<strong>server. xml</strong>以及<strong>web.xml</strong>等，</p>
<p>最后， Tomcat提供了<strong>Bootstrap</strong>作为<strong>应用服务器启动入口</strong>。 <strong>Bootstrap</strong>负责<strong>创建Catalina实例</strong>，根据执行参数调用Catalina相关方法完成针对应用服务器的操作（启动、停止）。</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927152815.png" alt=""></p>
<p>Tomcat的启动方式可以作为非常好的示范来指导中间件产品设计。它实现了<strong>启动入口</strong>与<strong>核心环境</strong>的<strong>解耦</strong>，这样不仅<strong>简化了启动</strong>，而且<strong>便于</strong>我们更<strong>灵活地组织中间件产品的结构</strong>，尤其是<strong>类加载器</strong>的方案。</p>
<p>Tomcat也可以不通过Bootstrap和Catalina来启动服务器，Tomcat提供了一个同名类org.apache.catalina.startup.Tomcat，使用它我们可以将Tomcat服务器嵌入到我们的应用系统中并进行启动。</p>
<p>最后，通过一个表格来总结Tomcat服务器中的概念</p>
<table>
<thead>
<tr>
<th>组件名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Server</td>
<td><strong>Server</strong>表示<strong>整个Servlet容器</strong>，因此 Tomcat运行环境中只有唯一一个Server实例</td>
</tr>
<tr>
<td>Service</td>
<td><strong>Service</strong>表示<strong>一个或者多个 Connector的集合</strong>，这些 Connector<strong>共享同一个 Container来处理请求</strong>。在同一个 Tomcat实例内可以包含任意多个 Service实例，它们彼此独立</td>
</tr>
<tr>
<td>Connector</td>
<td>即<strong>Tomcat链接器</strong>，用于<strong>监听并转化 Socket请求</strong>，同时将读取的 Socket请求交由 Container处理，支持<strong>不同协议</strong>以及<strong>不同的I/O方式</strong></td>
</tr>
<tr>
<td>Container</td>
<td>表示<strong>能够执行客户端请求并返回响应的一类对象</strong>。在Tomcat中存在不同级别的容器：Engine、Host、 Context、 Wrapper</td>
</tr>
<tr>
<td>Engine</td>
<td>Engine表示<strong>整个Servlet引擎</strong>。在 Tomcat中， Engine为最高层级的容器对象。尽管 Engine不是直接处理请求的容器，却是获取目标容器的入口</td>
</tr>
<tr>
<td>Host</td>
<td>Host作为一类容器，表示<strong>Servlet引擎（即 Engine）中的虚拟机</strong>，与一个服务器的网络名有关如域名等。客户端可以使用这个网络名连接服务器，这个名称必须要在DNS服务器上注册</td>
</tr>
<tr>
<td>Context</td>
<td><strong>Context作为一类容器</strong>，用于表示 ServletContext，在 Servlet规范中，一个 ServletContext即<strong>表示一个独立的Web应用</strong></td>
</tr>
<tr>
<td>Wrapper</td>
<td>wrapper作为一类容器，用于表示<strong>Web应用</strong>中定义的<strong>Servlet</strong></td>
</tr>
<tr>
<td>Executor</td>
<td>Executor表示Tomcat<strong>组件间</strong>可以<strong>共享</strong>的<strong>线程池</strong></td>
</tr>
</tbody>
</table>
<h3 id="22-tomcat启动"><a class="markdownIt-Anchor" href="#22-tomcat启动"></a> 2.2 Tomcat启动</h3>
<p>Tomcat的启动如下图</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927154104.png" alt=""></p>
<ul>
<li>从图中我们可以看出， Tomcat的<strong>启动过程</strong>非常<strong>标准化</strong>，统一按照生命周期管理接口 Lifecycle的定义进行启动。</li>
<li>首先，调用<code>init()</code>方法进行组件的<strong>逐级初始化</strong>，然后再调用<code>start()</code>方法进行<strong>启动</strong>。当然，每次调用均伴随着生命周期状态变更事件的触发。</li>
<li><strong>每一级组件</strong>除完成自身的处理外，还要<strong>负责调用子组件相应的生命周期管理方法</strong></li>
<li><strong>组件与组件</strong>之间是<strong>松耦合的设计</strong>，因此我们很容易通过配置进行修改和替换</li>
</ul>
<h3 id="23-请求处理"><a class="markdownIt-Anchor" href="#23-请求处理"></a> 2.3 请求处理</h3>
<p>从本质上讲，应用服务器的请求处理开始于监听的 Socket端口接收到数据，结束于将服务器处理结果写入 Socket输出流。</p>
<ul>
<li>在这个处理过程中，<strong>应用服务器</strong>需要<strong>将请求</strong>按照既定协议进行<strong>读取</strong>，并<strong>封装</strong>为<strong>与具体通信方案无关</strong>的<strong>请求对象</strong>。</li>
<li>然后根据<strong>请求映射规则</strong> <strong>定位</strong>到<strong>具体的处理单元</strong>。</li>
<li>当Servlet或者控制器的业务处理结束后，<strong>处理结果</strong>将被写入一个<strong>与通信方案无关的响应对象</strong>。</li>
<li>最后，该响应对象将<strong>按照既定协议写入输出流</strong>。</li>
</ul>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/21312.jpg" alt=""></p>
<h3 id="24-类加载器"><a class="markdownIt-Anchor" href="#24-类加载器"></a> 2.4 类加载器</h3>
<p>本节将主要介绍 Tomcat的类加载机制，包括 Tomcat类加载器层级设计以及Web应用的类加载过程。类加载是一切Java应用运行的基础，了解一款应用的类加载机制会便于我们掌握它的运行边界，也有助于其运行时异常的快速定位。</p>
<h4 id="241-j2se标准类加载器"><a class="markdownIt-Anchor" href="#241-j2se标准类加载器"></a> 2.4.1 J2SE标准类加载器</h4>
<p>JVM默认提供了三个类加载器，它们以一种<strong>父子树</strong>的方式<strong>创建</strong>，同时<strong>使用委派模式</strong>确保应用程序可通过自身的类加载器加载所有可见的Java类。结构如图2-19所示。</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200927155015.png" alt=""></p>
<ul>
<li>Bootstrap：用于加载<strong>JVM提供</strong>的<strong>基础运行类</strong></li>
<li>Extension：Java提供的一个标准的<strong>扩展</strong>机制用于加载<strong>除核心类库外的Jar包</strong></li>
<li>System：System类加载器通常用于<strong>加载应用程序Jar包</strong>及其<strong>启动入口类</strong>（ Tomcat的 Bootstrap类即由 System类加载器加载）</li>
</ul>
<p>Java默认的<strong>类加载机制</strong>是<strong>委派模式</strong>，委派的过程如下：</p>
<ol>
<li>从<strong>缓存中加载</strong>。</li>
<li>如果缓存中没有，则从<strong>父类加载器</strong>中加载。</li>
<li>如果父类加载器没有，则从<strong>当前类加载器</strong>加载。</li>
<li>如果没有，则<strong>抛出异常</strong>。</li>
</ol>
<p><strong>应用程序</strong>在<strong>不自己构造类加载器</strong>的情况下，<strong>使用 System作为默认的类加载器</strong>。如果应用程序<strong>自己构造类加载器</strong>，基本也<strong>以 System作为父类加载器</strong>。</p>
<h4 id="242-tomcat加载器"><a class="markdownIt-Anchor" href="#242-tomcat加载器"></a> 2.4.2 Tomcat加载器</h4>
<p>Tomcat加载器要<strong>考虑</strong>如下几点<strong>架构要素</strong></p>
<ul>
<li><strong>隔离性</strong>：Web应用类库相互隔离，<strong>避免依赖库</strong>或者应用包<strong>相互影响</strong>。</li>
<li><strong>灵活性</strong>：既然Web应用之间的类加载器相互独立，那么我们就能<strong>只针对一个Web应用进行重新部署</strong>，此时该Web应用的类加载器将会重新创建，而且不会影响其他web应用。</li>
<li><strong>性能</strong>：由于每个Web应用都有一个类加载器，因此<strong>web应用在加载类时，不会搜索其他Web应用包含的Jar包</strong>，性能自然高于应用服务器只有一个类加载器的情况。</li>
</ul>
<p>下面看一下Tomcat的类加载方案</p>
<p><img src="https://healthlung.oss-cn-beijing.aliyuncs.com/20200928122827.png" alt=""></p>
<p>Tomcat提供了3个基础的类加载器和web应用类加载器，而且这3个类加载器指向的路径和包列表均可以由 catalina.properties配置</p>
<ul>
<li>Common：以 System为父类加载器，是位于Tomcat服务器顶层的公用类加载器。Common类加载器负责<strong>加载Tomcat应用服务器内部和Web应用均可见的类</strong>，例如 <strong>Servlet规范相关包</strong>和一些<strong>通用的工具包</strong>。</li>
<li>Catalina：以 Common为父加载器，是用于加载 <strong>Tomcat应用服务器</strong>的类加载器，Catalina类加载器负责加载只有 Tomcat应用服务器内部可见的类，<strong>这些类对Web应用不可见</strong>，如 Tomcat的具体实现类</li>
<li>Shared：以 Common为父加载器，是<strong>所有web应用</strong>的<strong>父加载器</strong>，Shared类加载器负责加载web应用共享的类，这些类 Tomcat服务器不会依赖。</li>
<li>Web应用：以 Shared为父加载器，该类加载器<strong>只对当前web应用可见</strong>，对其他Web应用均不可见。</li>
</ul>
<p>接下来，我们从架构层面讨论一下 Tomcat的类加载器方案。下面几点是对上述<strong>架构分析的补充</strong>：</p>
<ul>
<li><strong>共享</strong>：
<ul>
<li>Tomcat通过 Common类加载器实现了Jar包在应用服务器以及Web应用之间共享，</li>
<li>通过 Shared类加载器实现了Jar包在Web应用之间的共享，</li>
<li>通过 Catalina类加载器加载服务器依赖的类。</li>
<li>这样最大程度上实现了Jar包的共享，而且又确保了不会引入过多无用的包</li>
</ul>
</li>
<li><strong>隔离性</strong>。这里的隔离性区别于前者，指<strong>服务器与web应用的隔离</strong>。理论上，除去 Servlet规范定义的接口外，我们的web应用不应依赖服务器的任何实现类，这样才有助于web应用的可移植性。正因如此， Tomcat支持通过 Catalina类加载器加载服务器依赖的包（尽管 Tomcat默认并没有这么做），以便应用服务器与Web应用更好地隔离。</li>
</ul>
<h4 id="243-web应用类加载器"><a class="markdownIt-Anchor" href="#243-web应用类加载器"></a> 2.4.3 Web应用类加载器</h4>
<p>Tomcat提供的web应用类加载器与默认的委派模式稍有不同。当进行类加载时，除JM基础类库外，它会首先尝试通过当前类加载器加载，然后才进行委派。</p>
<ul>
<li>从缓存中加载。</li>
<li>如果没有，则从JVM的 Bootstrap类加载器加载。</li>
<li>如果没有，则从当前类加载器加载</li>
<li>如果没有，则从父类加载器加载，由于父类加载器采用默认的委派模式，所以加载顺序为 System、 Common、 Shared</li>
</ul>
<p>Tomcat提供了 delegate属性用于控制是否启用Java委派模式，默认为 false（不启用）。</p>
<p>Tomcat通过该机制实现为<strong>Web应用中的Jar包</strong> <strong>覆盖</strong> <strong>服务器提供包</strong>的目的。如上所述，Java核心类库、 Servlet规范相关类库是无法覆盖的，此外Java默认提供的诸如XML工具包，由于位于JVM的 Bootstrap类加载器也无法覆盖，只能通过 endorsed的方式实现。</p>

                                                
            </div>
            <div class="article-footer">
                <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://t0ugh.biz/2020/11/11/Tomcat-2-Tomcat总体架构/" title="[Tomcat][2][Tomcat总体架构]" target="_blank" rel="external">https://t0ugh.biz/2020/11/11/Tomcat-2-Tomcat总体架构/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/t0ugh" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="https://i.loli.net/2020/03/21/WAKimNUecFR64uo.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/t0ugh" target="_blank"><span class="text-dark">T0UGH</span><small class="ml-1x">学生&amp;编程爱好者</small></a></h3>
        <div>很拽很拽很拽很拽很拽很拽很拽很拽</div>
      </div>
    </figure>
  </div>
</div>


            </div>
    </article>
    
        
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


            
</div>

    <nav class="bar bar-footer clearfix" data-stick-bottom="">
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2020/11/11/神经网络与深度学习-3-线性模型/" title="[神经网络与深度学习][3][线性模型]"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2020/11/11/Tomcat-1-Tomcat介绍/" title="[Tomcat][1][Tomcat介绍]"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
        

            
</main>

  <footer class="footer" itemscope="" itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/t0ugh" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script src="/js/plugin.min.js"></script>
<script src="/js/application.js"></script>

    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>





   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'E1MH6h0YP3yhA0PJsohNBgiT-gzGzoHsz',
    appKey: 'YOiN6zLq3XGfKmlR0b8vyHtN',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>