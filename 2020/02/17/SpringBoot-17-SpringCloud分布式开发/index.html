<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="SpringBoot,SpringCloud,">










<meta name="description" content="第 17 章 SpringCloud分布式开发按照现今互联网的开发，高并发、大数据、快响应已经是普遍的要求。为了支撑这样的需求，互联网系统也开始引入分布式的开发。为了实现分布式的开发， Spring推出了一套组件，那就是 Spring Cloud。它将目前各家公司已经开发好的、经过实践考验较为成熟的技术组合起来，并且通过 Spring Boot风格进行再次封装，从而屏蔽掉了复杂的配置和实现原理，为">
<meta name="keywords" content="SpringBoot,SpringCloud">
<meta property="og:type" content="article">
<meta property="og:title" content="[SpringBoot][17][SpringCloud分布式开发]">
<meta property="og:url" content="http://yoursite.com/2020/02/17/SpringBoot-17-SpringCloud分布式开发/index.html">
<meta property="og:site_name" content="打怪升级日常">
<meta property="og:description" content="第 17 章 SpringCloud分布式开发按照现今互联网的开发，高并发、大数据、快响应已经是普遍的要求。为了支撑这样的需求，互联网系统也开始引入分布式的开发。为了实现分布式的开发， Spring推出了一套组件，那就是 Spring Cloud。它将目前各家公司已经开发好的、经过实践考验较为成熟的技术组合起来，并且通过 Spring Boot风格进行再次封装，从而屏蔽掉了复杂的配置和实现原理，为">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2020/02/17/SpringBoot-17-SpringCloud分布式开发/200215_7.png">
<meta property="og:image" content="http://yoursite.com/2020/02/17/SpringBoot-17-SpringCloud分布式开发/200215_8.png">
<meta property="og:image" content="http://yoursite.com/2020/02/17/SpringBoot-17-SpringCloud分布式开发/200217_0.png">
<meta property="og:image" content="http://yoursite.com/2020/02/17/SpringBoot-17-SpringCloud分布式开发/200217_1.png">
<meta property="og:updated_time" content="2020-02-17T06:44:15.573Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[SpringBoot][17][SpringCloud分布式开发]">
<meta name="twitter:description" content="第 17 章 SpringCloud分布式开发按照现今互联网的开发，高并发、大数据、快响应已经是普遍的要求。为了支撑这样的需求，互联网系统也开始引入分布式的开发。为了实现分布式的开发， Spring推出了一套组件，那就是 Spring Cloud。它将目前各家公司已经开发好的、经过实践考验较为成熟的技术组合起来，并且通过 Spring Boot风格进行再次封装，从而屏蔽掉了复杂的配置和实现原理，为">
<meta name="twitter:image" content="http://yoursite.com/2020/02/17/SpringBoot-17-SpringCloud分布式开发/200215_7.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/02/17/SpringBoot-17-SpringCloud分布式开发/">





  <title>[SpringBoot][17][SpringCloud分布式开发] | 打怪升级日常</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/T0UGH" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">打怪升级日常</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">两星炸弹人(╯‵□′)╯炸弹！•••</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/17/SpringBoot-17-SpringCloud分布式开发/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="T0UGH(GuiPing Wang)">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/33653960?s=400&u=eb438b904ecb9d91f3aa9b777155a6488599493b&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="打怪升级日常">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">[SpringBoot][17][SpringCloud分布式开发]</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-17T14:43:43+08:00">
                2020-02-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/SpringBoot/" itemprop="url" rel="index">
                    <span itemprop="name">SpringBoot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/02/17/SpringBoot-17-SpringCloud分布式开发/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/02/17/SpringBoot-17-SpringCloud分布式开发/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="第-17-章-SpringCloud分布式开发"><a href="#第-17-章-SpringCloud分布式开发" class="headerlink" title="第 17 章 SpringCloud分布式开发"></a>第 17 章 SpringCloud分布式开发</h2><p>按照现今互联网的开发，高并发、大数据、快响应已经是普遍的要求。为了支撑这样的需求，互联网系统也开始引入分布式的开发。为了实现分布式的开发， Spring推出了一套组件，那就是 Spring Cloud。它将目前各家公司已经开发好的、经过实践考验较为成熟的技术组合起来，并且通过 Spring Boot风格进行再次封装，从而屏蔽掉了复杂的配置和实现原理，为开发者提供了一套简单易懂、易部署和维护的分布式系统开发包。</p>
<p>Spring Cloud是一套组件，可以细分为多种组件，如服务发现、配置中心、消息总线、负载均衡、断路器和数据监控等。</p>
<ul>
<li><p>服务治理和服务发现</p>
<ul>
<li>在 Spring Cloud中主要是使用 Netflix Eureka作为服务治理的</li>
<li>通过服务注册将单个微服务节点注册给服务治理中心，这样服务治理中心就可以治理单个微服务节点</li>
<li>服务发现则是微服务节点可以对服务治理中心发送消息，使得服务治理中心可以将新的微服务节点纳入管理。</li>
</ul>
</li>
<li><p>客户端负载均衡</p>
<ul>
<li>在微服务的开发中，会将一个大的系统拆分为多个微服务系统，而各个微服务系统之间需要相互协作才能完成业务需求。每一个微服务系统可能存在多个节点，当个微服务（服务消费者）调用另外一个微服务（服务提供者）时，服务提供者需要负载均衡算法提供一个节点进行响应。</li>
<li>除此之外，在服务的过程中，可能出现某个节点故障的风险，通过均衡负载的算法就可以将故障节点排除，使后续请求分散到其他可用节点上</li>
<li>Spring Cloud为此提供了 Ribbon 来实现这些功能，主要使用的就是 RestTemplate</li>
</ul>
</li>
<li><p>声明服务调用</p>
<ul>
<li>对于REST风格的调用，如果使用 RestTemplate会比较烦琐，可读性不高</li>
<li>为了简化多次调用的复杂度， Spring Cloud提供了接口式的声明服务调用编程，它就是 Feign</li>
<li>通过它请求其他微服务时，就如同调度本地服务的Java接口一样，从而提高代码的可读性</li>
</ul>
</li>
<li><p>断路器</p>
<ul>
<li>在分布式中，因为存在网络延迟或者故障，所以一些服务调用无法及时响应。如果此时服务消费者还在大量地调用这些网络延迟或者故障的服务提供者，那么很快消费者也会因为大量的等待，造成积压，最终导致其自身出现服务瘫痪。</li>
<li>为了克服这个问题， Spring Cloud引入了Netⅸx的开源框架 Hystix来处理这些问题。当服务提供者响应延迟或者故障时，就会使得服务消费者长期得不到响应， Hystix断路器就会对这些延迟或者故障的服务进行</li>
<li>这样，当服务消费者长期得不到服务提供者响应时，就可以进行降级、服务断路、线程和信号隔离、请求缓存或者合并等处理</li>
</ul>
</li>
<li><p>API网关</p>
<ul>
<li>在 Spring Cloud中API网关是Zuul。对于网关而言，存在两个作用。</li>
<li>第一个作用是将请求的地址映射为真实服务器的地址，显然这个作用就起到路由分发的作用，从而降低单个节点的负载。</li>
<li>Zuul网关的第二个作用是过滤服务，在互联网中，服务器可能面临各种攻击，Zuul提供了过滤器，通过它过滤那些恶意或者无效的请求，把它们排除在服务网站之外，这样就可以降低网站服务的风险。</li>
</ul>
</li>
</ul>
<p>为了更好的理解各个组件，我们举个例子来说明<br><img src="/2020/02/17/SpringBoot-17-SpringCloud分布式开发/200215_7.png" alt=""><br>假设需要实现一个电商项目，当前团队需要承担两个模块的开发，分别是用户模块和产品模块。根据微服务的特点，将系统拆分为用户服务和产品服务，而两个服务通过REST风格请求进行交互。在分布式的环境下，为了提高处理能力、分摊单个系统的压力以及高可用的要求，往往需要一个微服务拥有两个或者以上的节点，如图17-1所示的架构。</p>
<h3 id="17-1-服务治理和服务发现：Eureka"><a href="#17-1-服务治理和服务发现：Eureka" class="headerlink" title="17.1 服务治理和服务发现：Eureka"></a>17.1 服务治理和服务发现：Eureka</h3><h4 id="17-1-1-配置服务治理节点"><a href="#17-1-1-配置服务治理节点" class="headerlink" title="17.1.1 配置服务治理节点"></a>17.1.1 配置服务治理节点</h4><p>Spring Cloud的服务治理是使用 Netflix的 Eureka作为服务治理器的，它是构建 Spring Cloud 分布式最为核心和最为基础的模块，它的作用是注册和发现各个 Spring Boot 微服务，并且提供监控和治理功能</p>
<p>下面演示如何搭建一个服务注册中心</p>
<p>首先在<code>pom.xml</code>中引入依赖<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这样就引入了 Eureka 模块的包。然而要启用它只需要在 Spring boot 的启动文件上加入注解<code>@EnableEurekaServer</code>便可以了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter17ServerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Chapter17ServerApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们还需要使用 <code>application.properties</code>进一步配置 Eureka 模块的一些基本内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#Spring项目名称</span><br><span class="line">spring.application.name=server</span><br><span class="line">#服务器端口</span><br><span class="line">server.port=7001</span><br><span class="line"># Eureka注册服务器名称</span><br><span class="line">eureka.instance.hostname=localhost</span><br><span class="line">#是否注册给服务中心</span><br><span class="line">eureka.client.register-with-eureka=false</span><br><span class="line">#是否检索服务</span><br><span class="line">eureka.client.fetch-registry=false</span><br><span class="line"># 治理客户端服务域</span><br><span class="line">eureka.client.serviceuUrl.defaultZone=http://localhost:7001/eureka/</span><br></pre></td></tr></table></figure></p>
<ul>
<li>属性<code>spring application.name</code>配置为<code>server</code>，这是一个标识，它表示某个微服务的共同标识。如果有第二个微服务节点启动时，也是将这个配置设为<code>server</code>，那么 Spring Cloud就会认为它也是<code>server</code>这个微服务的一个节点。</li>
<li>属性<code>eureka.client.register-with-eureka</code>配置为<code>false</code>，是因为在默认的情况下，项目会自动地查找服务治理中心去注册。这个工程自身就是服务治理中心，所以取消掉注册服务中心。</li>
<li>属性<code>eureka.client.fetch-registry</code>配置为<code>false</code>，它是一个检索服务的功能，因为服务治理中心是维护服务实例的，所以也不需要这个功能，即设置为了<code>false</code></li>
<li>属性<code>eureka.client.serviceUrl.defaultZone</code>代表服务中心的域，将来可以提供给别的微服务注册。后面的微服务还会使用到它。</li>
</ul>
<p>然后启动服务，并使用浏览器访问它<br><img src="/2020/02/17/SpringBoot-17-SpringCloud分布式开发/200215_8.png" alt=""></p>
<h4 id="17-1-2-服务发现"><a href="#17-1-2-服务发现" class="headerlink" title="17.1.2 服务发现"></a>17.1.2 服务发现</h4><p>下面我们新建一个产品微服务，然后让<code>Eureka</code>去发现它</p>
<p>首先在<code>pom.xml</code>中引入<code>Eureka</code>客户端包<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">....</span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后使用<code>application.properties</code>来配置具体注册到哪个服务治理中心<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#服务器端口</span><br><span class="line">server.port=9001</span><br><span class="line">#Spring服务名称</span><br><span class="line">spring.application.name=product</span><br><span class="line">#治理客户端服务域</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:7001/eureka/</span><br></pre></td></tr></table></figure></p>
<ul>
<li>治理客户端服务域则是通过属性<code>eureka.client.serviceUrl.defaultZone</code>进行配置的，它也配置了服务治理中心同样的地址，这样它就能够注册到之前所配置的服务治理中心。</li>
</ul>
<p>接着我们再使用上面的步骤创建一个用户微服务</p>
<h4 id="17-1-3-配置多个服务治理中心节点"><a href="#17-1-3-配置多个服务治理中心节点" class="headerlink" title="17.1.3 配置多个服务治理中心节点"></a>17.1.3 配置多个服务治理中心节点</h4><p>我们现在希望存在两个服务治理中心节点，因为在服务治理中心也可能单个节点出现故障，导致服务不可用。</p>
<p>这时，我们首先修改上面<code>server</code>工程的配置文件，将这个服务的服务注册中心改为7002端口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#Spring应用名称</span><br><span class="line">spring.application.name=server</span><br><span class="line">#端口</span><br><span class="line">server port=7001</span><br><span class="line">#服务治理中心名称</span><br><span class="line">eureka.instance.hostname=localhost</span><br><span class="line">#将当前服务治理中心注册到7002端口的服务治理中</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:7002/eureka/</span><br></pre></td></tr></table></figure></p>
<p>接下来我们将这个工程整个复制，修改配置文件如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#Spring应用名称</span><br><span class="line">spring.application.name=server</span><br><span class="line">#端口</span><br><span class="line">server port=7002</span><br><span class="line">#服务治理中心名称</span><br><span class="line">eureka.instance.hostname=localhost</span><br><span class="line">#将当前服务治理中心注册到7002端口的服务治理中</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:7001/eureka/</span><br></pre></td></tr></table></figure></p>
<p>这里可以看到两个服务治理中心是通过相互注册来保持相互监控的，关键点是属性<code>spring.application.name</code>保持一致都为<code>server</code>，这样就可以形成两个甚至是多个服务治理中心</p>
<p>接下来，需要考虑的是如何将其他的微服务注册到多个服务治理中心中。下面以单个产品微服务为例来修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#服务器端口</span><br><span class="line">server.port=9001</span><br><span class="line">#Spring服务名称</span><br><span class="line">spring.application.name=product</span><br><span class="line">#注册多个治理客户端服务域</span><br><span class="line">eureka.client.serviceurl.defaultzone=http://localhost7001/eureka/, http://localhost:7002/eureka/</span><br></pre></td></tr></table></figure></p>
<h3 id="17-2-微服务之间的调用"><a href="#17-2-微服务之间的调用" class="headerlink" title="17.2 微服务之间的调用"></a>17.2 微服务之间的调用</h3><p>上面已经把产品和用户两个微服务注册到服务治理中心了。对于业务，则往往需要各个微服务之间相互地协助才能完成。为了方便从其他微服务中获取信息，生产者微服务会以<code>REST</code>风格提供一个请求<code>URL</code>。这样对于消费者微服务就可以通过<code>REST</code>请求获取用户服务。</p>
<p>除了处理获取其他服务的数据外，这里还需要注意服务节点之间的负载均衡。Spring Cloud提供了<code>Ribbon</code>和<code>Feign</code>组件来帮助我们完成这些功能。通过它们，各个微服务之间就能够相互调用，并且它会默认实现了负载均衡。</p>
<h4 id="17-2-1-Ribbon客户端负载均衡"><a href="#17-2-1-Ribbon客户端负载均衡" class="headerlink" title="17.2.1 Ribbon客户端负载均衡"></a>17.2.1 Ribbon客户端负载均衡</h4><p>假如有多个生产者服务，消费者应该访问哪个呢？这就是客户端负载均衡。而在SpringCloud体系中，客户端负载均衡时通过Ribbon实现的。对于Ribbon，它实际就是一个 RestTemplate对象。Spring Cloud提供了一个简单的<code>@LoadBalance</code>注解以实现客户端的负载均衡负载均衡的算法。</p>
<p>下面还是以用户微服务和产品微服务举例。假设此时用户微服务已经开发好了一个REST风格的接口，且在Eureka中注册了两个实例，这时，产品微服务要调用用户微服务，只要进行如下步骤就可以实现负载均衡了</p>
<p>首先加入对 Ribbon 的依赖<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org. springframework cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后为RestTemplate加入负载均衡标签<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringCloudApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter17ProductApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化RestTemplate</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span> <span class="comment">// 多节点负载均衡</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"restTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">initRestTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Chapter17ProductApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这段代码中在<code>RestTemplate</code>上加入了注解<code>@LoadBalanced</code>。它的作用是让<code>RestTemplate</code>实现负载均衡，也就是，通过这个<code>RestTemplate</code>对象调用用户微服务请求的时候，<code>Ribbon</code>会自动给用户微服务节点实现负载均衡，这样请求就会被分摊到微服务的各个节点上，从而降低单点的压力。</p>
<p>为了测试在产品微服务中新建产品控制器，通过<code>RestTemplate</code>进行调用即可<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注入RestTemplate</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RestTemplate restTemplate = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/ribbon"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> UserPo <span class="title">testRibbon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    UserPo user = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 循环10次，然后可以看到各个用户微服务后台的日志打印</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 注意这里直接使用了USER这个服务ID，代表用户微服务系统</span></span><br><span class="line">        <span class="comment">// 该ID通过属性spring.application.name来指定</span></span><br><span class="line">        user = restTemplate.getForObject(<span class="string">"http://USER/user/"</span> + (i + <span class="number">1</span>), UserPo.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码中注入了<code>RestTemplate</code>对象，这是自动实现客户端均衡负载的对象。然后在方法中使用<code>USER</code>这个字符串代替了服务器及其端口，这是一个服务ID，在Eureka服务器中可以看到它的各个节点，它是用户微服务通过属性 <code>spring.application.name</code>来指定的。</p>
<h4 id="17-2-2-Feign声明式调用"><a href="#17-2-2-Feign声明式调用" class="headerlink" title="17.2.2 Feign声明式调用"></a>17.2.2 Feign声明式调用</h4><p>上节中使用了<code>RestTemplate</code>，但是使用<code>RestTemplate</code>有些麻烦。除了要编写URL，还需要注意这些参数的组装和结果的返回等操作。为了克服这些不友好，除了Ribbon外，Spring Cloud还提供了声明式调用组件Feign。</p>
<p>Feign是一个基于接口的编程方式，开发者只需要声明接口和配置注解，在调度接口方法时Spring Cloud就根据配置来调度对应的REST风格的请求，从其他微服务系统中获取数据。</p>
<p>我们举例来说明，首先引入依赖包<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后需要在 Spring Boot 的启动文件中加入注解<code>@EnableFeignClients</code>，这个注解代表该项目会启动 Feign客户端。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span>(basePackages = <span class="string">"com.springboot.chapter17.product"</span>)</span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.springboot.chapter17.product"</span>)</span><br><span class="line"><span class="meta">@SpringCloudApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter17ProductApplication</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在产品微服务中加入接口声明，注意这里仅仅是一个接口声明，并不需要实现类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**** imports ****/</span></span><br><span class="line"><span class="comment">// 指定服务ID（Service ID）</span></span><br><span class="line"><span class="meta">@FeignClient</span>(<span class="string">"user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 指定通过HTTP的GET方法请求路径</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/user/&#123;id&#125;"</span>)</span><br><span class="line">	<span class="comment">// 这里会采用Spring MVC的注解配置</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> UserPo <span class="title">getUser</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// POST方法请求用户微服务</span></span><br><span class="line">	<span class="meta">@PostMapping</span>(<span class="string">"/insert"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">addUser</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			// 请求体参数</span></span></span><br><span class="line"><span class="function"><span class="params">			@RequestBody UserPo user)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// POST方法请求用户微服务</span></span><br><span class="line">	<span class="meta">@PostMapping</span>(<span class="string">"/update/&#123;userName&#125;"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">updateName</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			// URL参数</span></span></span><br><span class="line"><span class="function"><span class="params">			@PathVariable(<span class="string">"userName"</span>)</span> String userName,</span></span><br><span class="line"><span class="function">			<span class="comment">// 请求头参数</span></span></span><br><span class="line"><span class="function">			@<span class="title">RequestHeader</span><span class="params">(<span class="string">"id"</span>)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用用户微服务的timeout请求</span></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/timeout"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testTimeout</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>@FeignClient(&quot;user&quot;)</code>代表这是一个Feign客户端配置的<code>user</code>是一个服务的ID，它指向了用户微服务，这样Feign就会知道向用户微服务请求，并会实现负载均衡。这里的注解<code>@GetMapping</code>代表启用HTTP的GET请求用户微服务，而方法中的注解<code>@PathVariable</code>代表从URL中获取参数，这显然还是Spring MVC的规则，Spring Cloud之所以选择这样的方式，是为了降低读者的学习成本。然后通过IOC技术，这个<code>service</code>会在spring容器中产生一个可供调用实例。</p>
<p>下一步，在<code>Controller</code>中就可以像调用本地的<code>Service</code>一样去调用它了<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注入Feign接口</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserService userService = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/feign"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> UserPo <span class="title">testFeign</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    UserPo user = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 循环10次</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        Long id = (<span class="keyword">long</span>) (i + <span class="number">1</span>);</span><br><span class="line">        user = userService.getUser(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>与Ribbon相比，Feign屏蔽掉了<code>RestTemplate</code>的使用，提供了接口声明式的调用，使得程序可读性更高，同时在多次调用中更为方便。</p>
<h3 id="17-3-Hystrix断路器"><a href="#17-3-Hystrix断路器" class="headerlink" title="17.3 Hystrix断路器"></a>17.3 Hystrix断路器</h3><p>在互联网中，可能存在某一个微服务的某个时刻压力变大导致服务缓慢，甚至出现故障，导致服务不能响应。这里假设用户微服务请求中出现压力过大，服务响应速度变缓，进入瘫痪状态，而这时产品微服务响应还是正常响应。但是如果出现产品微服务大量调用用户微服务，就会出现大量的等待，如果还是持续地调用，则会造成大量请求的积压，导致产品微服务最终也不可用。这种现象也称为雪崩</p>
<p><img src="/2020/02/17/SpringBoot-17-SpringCloud分布式开发/200217_0.png" alt=""></p>
<p>为了防止这样的蔓延，微服务提出了断路器的概念。断路器就如同电路中的保险丝，如果电器耗电大，导致电流过大，那么保险丝就会熔断，从而保证用电的安全。同样地，在微服务系统之间大量调用可能导致服务消费者自身出现瘫痪的情况下，断路器就会将这些积压的大量请求“熔断”，来保证其自身服务可用，而不会蔓延到其他微服务系统上。通过这样的断路机制可以保持各个微服务持续可用。</p>
<p>处理限制请求的方式的策略很多，如限流、缓存等。这里主要介绍最为常用的降级服务。所谓降级服务，就是当请求其他微服务出现超时（timeout）或者发生故障时，就会使用自身服务其他的方法进行响应。</p>
<p>下面举例说明，这里首先在用户微服务中新增REST端点用来模拟超时<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/timeout"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">timeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 生成一个3000之内的随机数</span></span><br><span class="line">    <span class="keyword">long</span> ms = (<span class="keyword">long</span>)(<span class="number">3000L</span>*Math.random());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 程序延迟，有一定的概率超过2000毫秒</span></span><br><span class="line">        Thread.sleep(ms);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"熔断测试"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个方法没有任何业务含义，只是会使用<code>sleep</code>方法让当前线程休眠随机的毫秒数。这个毫杪数可能超过2000mns，也就是有可能超过 Hystrix 所默认的2000ms的时间，这样就可以出现短路，进入降级方法。</p>
<p>接下来我们在产品微服务中启用断路器，首先需要在<code>maven</code>中引入它，然后在启动文件中加入<code>@EnableCircuitBreaker</code>就可以启动断路机制<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启动断路器</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="comment">//自定义扫描包</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.springboot.chapter17.product"</span>)</span><br><span class="line"><span class="comment">//开启Spring Boot应用、服务发现和断路器功能</span></span><br><span class="line"><span class="meta">@SpringCloudApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter17ProductApplication</span> </span>&#123;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们分别配置产品微服务里的<code>service</code>和<code>controller</code>就可以开始测试了<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用用户微服务的timeout请求</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/timeout"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testTimeout</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Feign断路测试</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/circuitBreaker2"</span>)</span><br><span class="line"><span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"error"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">circuitBreaker2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.testTimeout();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 降级服务方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">error</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"超时出错。"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先看到<code>@HystrixCommand</code>注解，它表示将在方法上启用断路机制，而其属性<code>fallbackMethod</code>则可以指定降级方法，指定为<code>error</code>，那么降级方法就是<code>error</code>。如此指定后，在请求<code>circuitBreaker2</code>时，只要超时过了2000ms，服务就会启用<code>error</code>方法作用响应请求，从而避免请求的积压，保证微服务的高可用性。</p>
<p>其流程如下图所示<br><img src="/2020/02/17/SpringBoot-17-SpringCloud分布式开发/200217_1.png" alt=""></p>
<h4 id="17-3-2启用Hystrix仪表盘"><a href="#17-3-2启用Hystrix仪表盘" class="headerlink" title="17.3.2启用Hystrix仪表盘"></a>17.3.2启用Hystrix仪表盘</h4><p>对于 Hystrix, Spring Cloud还提供了一个仪表盘（Dashboard）进行监控断路的情况，从而让开发者监控可能出现的问题。</p>
<p>这里直接贴出配置过程的代码，新建一个工程简单配置它即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****imports****/</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// 启用Hystrix仪表盘</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter17DashboardApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Chapter17DashboardApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server.port=6001</span><br><span class="line">spring.application.name=hystrix_dashboard</span><br></pre></td></tr></table></figure>
<p>具体如何使用略</p>
<h3 id="17-4-Zuul路由网关"><a href="#17-4-Zuul路由网关" class="headerlink" title="17.4 Zuul路由网关"></a>17.4 Zuul路由网关</h3><p>网关的功能对于分布式网站是十分重要的</p>
<ul>
<li>首先它可以将请求路由到真实的服务器上，进而保护真实服务器的IP地址，避免直接地攻击真实服务器</li>
<li>其次它也可以作为一种负载均衡的手段，使得请求按照一定的算法平摊到多个节点上，减缓单点的压力</li>
<li>最后它还能提供过滤器，过滤器可以判定请求是否为有效请求，一旦判定失败，就可以将请求阻止，避免发送到真实的服务器。</li>
</ul>
<h4 id="17-4-1-构建Zuul网关"><a href="#17-4-1-构建Zuul网关" class="headerlink" title="17.4.1 构建Zuul网关"></a>17.4.1 构建Zuul网关</h4><p>下面新建一个工程，作为<code>Zuul</code>网关</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入服务发现 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span>(scanBasePackages = <span class="string">"com.springboot.chapter17.zuul"</span>)</span><br><span class="line"><span class="comment">//启动Zuul代理功能</span></span><br><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter17ZuulApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Chapter17ZuulApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server.port=80</span><br><span class="line">spring.application.name=zuul</span><br><span class="line"></span><br><span class="line">zuul.routes.user-service.path=/u/**</span><br><span class="line">zuul.routes.user-service.url=http://localhost:8001/</span><br><span class="line"></span><br><span class="line">zuul.routes.product-service.path=/p/**</span><br><span class="line">zuul.routes.product-service.serviceId=product</span><br><span class="line"></span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:7001/eureka/,http://localhost:7002/eureka/</span><br></pre></td></tr></table></figure>
<ul>
<li>这里引入了服务发现的包，所以我们也可以参照之前的论述将Zuul网关服务注册到服务治理中心去。</li>
<li>Zuul已经引入了断路机制，之所以引入断路机制，是因为在请求不到的时候，会进行断路，以避免网关发生请求无法释放的场景，导致微服务瘫痪。</li>
<li>对于用户微服务映射的配置，这里采用 <code>zuul.routes.&lt;key&gt;.path</code>和 <code>zuul.routes.&lt;key&gt;.serviceId</code>进行配置，其中<code>path</code>是请求路径，这里使用了ANT风格的通配<code>/u/**</code>，而serviceId代表服务名称，这样配置后，zuul还会自动实现网关负载均衡，当请求到来时，会均衡请求到名字相同的服务集合上。</li>
<li>这时，当我们请求<code>http://localhost/p/product/ribbon</code>时，<code>http://localhost/</code>代表zuul网关的地址，<code>p</code>是我们刚才配置的转发，也就是product微服务的某个节点，而<code>/product/ribbon</code>则由product微服务再进一步解析寻址</li>
</ul>
<h4 id="17-4-2-使用过滤器"><a href="#17-4-2-使用过滤器" class="headerlink" title="17.4.2 使用过滤器"></a>17.4.2 使用过滤器</h4><p>有时候还希望网关功能更强大些。例如，监测用户登录、黑名单用户、购物验证码、恶意刷请求攻击等场景。如果这些在过滤器内判断失败，那么就不要再把请求转发到其他微服务上，以保护微服务的稳定。</p>
<p>具体实现略</p>
<h3 id="17-5-使用-SpringCloudApplication"><a href="#17-5-使用-SpringCloudApplication" class="headerlink" title="17.5 使用@SpringCloudApplication"></a>17.5 使用@SpringCloudApplication</h3><p>上面的内容中，对于启动文件采用了很多注解，如<code>@SpringBootApplication</code>、<code>@EnableDiscoveryClient</code>和<code>@EnableCircuitBreaker</code>等。这些注解有时候会让人觉得比较冗余，为了简化开发， Spring Cloud还提供了自己的注解<code>@SpringCloudApplication</code>来简化使用 Spring Cloud的开发。</p>
<p>使用了<code>@SpringCloudApplication</code>这个注解就相当于使用了<code>@SpringBootApplication</code>、<code>EnableDiscoveryClient</code>和<code>EnableCircuitBreaker</code>三个注解。</p>
<p>前面的产品微服务的启动文件就可以改为如下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span>(basePackages=<span class="string">"com.springboot.chapter17.product"</span>)</span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages=<span class="string">"com.springboot.charter17.product"</span>)</span><br><span class="line"><span class="meta">@SpringCloudApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter17ProductApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Chapter17ZuulApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>因为<code>@SpringCloudApplication</code>并不提供配置包的功能，所以使用<code>@ComponentScan</code>进行包扫描来弥补</li>
<li><code>@SpringCloudApplication</code>并不会自动启用 Feign，所以使用<code>@EnableFeignCLients</code>来启用 Feign</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/SpringBoot/" rel="tag"><i class="fa fa-tag"></i> SpringBoot</a>
          
            <a href="/tags/SpringCloud/" rel="tag"><i class="fa fa-tag"></i> SpringCloud</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/02/16/JVM-3-垃圾收集器与内存分配策略/" rel="next" title="[JVM][3][垃圾收集器与内存分配策略]">
                <i class="fa fa-chevron-left"></i> [JVM][3][垃圾收集器与内存分配策略]
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/02/19/JVM-6-类文件结构/" rel="prev" title="[JVM][6][类文件结构]">
                [JVM][6][类文件结构] <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/33653960?s=400&u=eb438b904ecb9d91f3aa9b777155a6488599493b&v=4" alt="T0UGH(GuiPing Wang)">
            
              <p class="site-author-name" itemprop="name">T0UGH(GuiPing Wang)</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">97</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">54</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/T0UGH" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="tough.neu.edu@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Friends
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://neusoftware.top/solo" title="ChengYi" target="_blank">ChengYi</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://mike4ellis.github.io/" title="Mike" target="_blank">Mike</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#第-17-章-SpringCloud分布式开发"><span class="nav-number">1.</span> <span class="nav-text">第 17 章 SpringCloud分布式开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#17-1-服务治理和服务发现：Eureka"><span class="nav-number">1.1.</span> <span class="nav-text">17.1 服务治理和服务发现：Eureka</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#17-1-1-配置服务治理节点"><span class="nav-number">1.1.1.</span> <span class="nav-text">17.1.1 配置服务治理节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17-1-2-服务发现"><span class="nav-number">1.1.2.</span> <span class="nav-text">17.1.2 服务发现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17-1-3-配置多个服务治理中心节点"><span class="nav-number">1.1.3.</span> <span class="nav-text">17.1.3 配置多个服务治理中心节点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-2-微服务之间的调用"><span class="nav-number">1.2.</span> <span class="nav-text">17.2 微服务之间的调用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#17-2-1-Ribbon客户端负载均衡"><span class="nav-number">1.2.1.</span> <span class="nav-text">17.2.1 Ribbon客户端负载均衡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17-2-2-Feign声明式调用"><span class="nav-number">1.2.2.</span> <span class="nav-text">17.2.2 Feign声明式调用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-3-Hystrix断路器"><span class="nav-number">1.3.</span> <span class="nav-text">17.3 Hystrix断路器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#17-3-2启用Hystrix仪表盘"><span class="nav-number">1.3.1.</span> <span class="nav-text">17.3.2启用Hystrix仪表盘</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-4-Zuul路由网关"><span class="nav-number">1.4.</span> <span class="nav-text">17.4 Zuul路由网关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#17-4-1-构建Zuul网关"><span class="nav-number">1.4.1.</span> <span class="nav-text">17.4.1 构建Zuul网关</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#17-4-2-使用过滤器"><span class="nav-number">1.4.2.</span> <span class="nav-text">17.4.2 使用过滤器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-5-使用-SpringCloudApplication"><span class="nav-number">1.5.</span> <span class="nav-text">17.5 使用@SpringCloudApplication</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">T0UGH(GuiPing Wang)</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'E1MH6h0YP3yhA0PJsohNBgiT-gzGzoHsz',
        appKey: 'YOiN6zLq3XGfKmlR0b8vyHtN',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  
  


  

  

</body>
</html>
